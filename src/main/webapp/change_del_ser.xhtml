<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html  xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
       xmlns:ui="jakarta.faces.facelets"
       xmlns:p="http://primefaces.org/ui">
    <h:head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Alterar / Excluir - Serviços</title>

        <h:outputScript library="js" name="main-srsr.js"/>
        <!--Aqui está chamando o arquivo javascript principal,
        nele existe uma propriedade que detecta alteração no form,
        para evitar mudar de tela por engano, ou antes de salvar -
        mediante confirmação em páginas, após salvar ou cancelar, chamar onclick="resetAlterado()"-->

        <div><ui:include src="/menu.xhtml" /></div>
        <!-- Essa propriedade ui:include é para reaproveitamento de código, no caso ela chama a página menu.xhtml -->

        <h:outputStylesheet library="css" name="app-srsr.css"/> <!--CHAMANDO O CSS GERAL PARA A PÁGINA -->

    </h:head>
    <h:body>
        <div class="titulo-pag-inteira">
            <p:outputLabel  value="ALTERAR / EXCLUIR -- SERVIÇOS --" />
        </div>
        <p:messages id="msgs" showDetail="true" closable="true" styleClass="auto-hide-msgs">
            <p:autoUpdate/>
        </p:messages>
        <p:growl id="growl" showDetail="true" life="4000" />
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" />

        <!-- Esse bloco aqui de cima, contém os ítens que são mensagens de confiramação ou coisas nesse sentido -->

        <h:form id="form">

            <p:dataTable id="servicos"
                         var="ser"
                         value="#{servicoBean.resultado}"
                         editable="true"

                         style="margin-bottom:20px"
                         rows="10"
                         paginator="true"
                         emptyMessage="Nenhum registro encontrado."
                         widgetVar="tabela"
                         globalFilterOnly="false"
                         >

                <p:column headerText="Cliente" filterBy="#{ser.clienteNome}">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{ser.clienteNome}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{ser.clienteNome}" style="width:100%" disabled="true" />
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Desccrição" filterBy="#{ser.descricao}">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{ser.descricao}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{ser.descricao}" style="width:100%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Data" filterBy="#{ser.data}">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{ser.data}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </f:facet>
                        <f:facet name="input">
                            <p:calendar id="data" value="#{ser.data}" pattern="dd/MM/yyyy" mask="true"
                                        style="width:50px" required="true"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Valor Cobrado" filterBy="#{ser.valorCobrado}">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{ser.valorCobrado}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{ser.valorCobrado}" style="width:100%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Observações" filterBy="#{ser.observacoes}">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{ser.observacoes}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{ser.observacoes}" style="width:100%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <div>
                    <p:column headerText="Alterar" width="50px">
                        <p:rowEditor editTitle="Editar Serviço" cancelTitle="Cancelar Edição" saveTitle="Salvar Edição"/>
                    </p:column>
                    <p:ajax event="rowEdit" listener="#{servicoBean.linhaEdita}" update="msgs growl" onsuccess="resetAlterado()" />
                    <p:ajax event="rowEditCancel" listener="#{servicoBean.linhaCancela}" update="servicos msgs growl"/>

                    <p:column headerText="Excluir" style="width:5rem; text-align:center">
                        <p:commandButton icon="pi pi-trash" title="Excluir"
                                         styleClass="ui-button-danger ui-button-flat"
                                         actionListener="#{servicoBean.preparaExclusao(ser)}"
                                         update=":form:servicos:confirmDialog"
                                         oncomplete="PF('confirmacao').show()">
                            <!-- //Método usado no botão de excluir, commandButton, passando o atributo "var" do DataTable,
                                        depois no ConfirmaDialog eu apenas confirmo a
                                        exclusão com o metodo excluir, sem parametro,
                                        pois o View do Beans já está com a variavel da entidade carregada na memória;
                            -->

                            <p:confirmDialog id="confirmDialog" widgetVar="confirmacao"
                                             header="Confirmação" message="Deseja realmente excluir este Serviço?"
                                             severity="warn" appendTo="@(body)">

                                <p:commandButton value="Sim" icon="pi pi-check"
                                                 actionListener="#{servicoBean.excluir()}"
                                                 update="servicos msgs growl"
                                                 onclick="PF('confirmacao').hide()"
                                                 onsuccess="resetAlterado()"
                                                 />

                                <p:commandButton value="Não" icon="pi pi-times"
                                                 onclick="PF('confirmacao').hide();" type="button" />
                            </p:confirmDialog>
                        </p:commandButton>
                    </p:column>
                </div>

                <!--PF() é um helper do PrimeFaces (abreviação de PrimeFaces Widget API).
                    Qualquer componente com widgetVar definido pode ser manipulado dessa forma:
                    PF('dialog').show() → abre um <p:dialog>.
                    PF('growl').clear() → limpa mensagens do <p:growl>.
                    PF('tabela').filter() → aciona o filtro global-->

            </p:dataTable> <!-- DataTable Edit e Column Filtering Propriedades do PrimeFaces -->
        </h:form>
    </h:body>
</html>
